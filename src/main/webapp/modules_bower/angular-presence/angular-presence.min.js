!function(){"use strict";angular.module("presence",[]).directive("presence",["$presence","types",function(a,b){function c(a){return a?a.split(" "):b.getAllTypeNames()}return{restrict:"A",link:function(d,e,f){angular.forEach(c(f.presence),function(c){var d=b.get(c);e.on(d.events,function(b){b=b.originalEvent||b,("mousemove"!==b.type||0!==b.movementX||0!==b.movementY)&&a.registerAction(d.name)})})}}}]).factory("types",function(){return{MOUSE:{name:"MOUSE",events:"click mousedown mouseup mousemove"},KEYBOARD:{name:"KEYBOARD",events:"keypress keydown keyup"},TOUCH:{name:"TOUCH",events:"touchstart touchmove touchend touchenter touchleave touchcancel"},getAllTypeNames:function(){return["MOUSE","KEYBOARD","TOUCH"]},get:function(a){if(a=a.toUpperCase(),this[a])return this[a];throw new Error("Unknown type for monitoring presence: "+a)}}}).factory("$presence",["$timeout","$log","orderByFilter","types",function(a,b,c,d){function e(a,b){function e(){return angular.forEach(a,function(b,c){angular.isObject(b)||(a[c]=b={enter:b}),b.name=c,b.enter=b.enter||0}),a}function g(){var b=[];return angular.forEach(a,function(a){b.push(a)}),c(b,"enter")}function h(){angular.forEach(q,function(a,b){a.id=b,a.onEnter=function(a){l(b,a)},a.onLeave=function(a){m(b,a)},a.activate=function(){f(b)}})}function i(){a.onChange=function(a){k(a)},a.getCurrent=function(){return n()}}function j(){angular.forEach(q,function(a,b){function c(c){-1===a.accept.toUpperCase().indexOf(c)&&(t[c]=b+1)}a.initial===!0&&(u=b),a.accept&&angular.forEach(d.getAllTypeNames(),c)})}return a=e(),q=g(),h(),i(),j(),b||f(u),a}function f(b){var c=r;if(!q[b])throw new Error("Unknown stateId: "+b);q[c]&&(q[c].leftOn=new Date,q[c].active=!1),q[b].active=!0,q[b].enteredOn=new Date,q[b].enteredFrom=q[c]?q[c].name:void 0,r=b,a(function(){h(v[c]),h(w[b]),h(x)}),i()}function g(){f(r+1)}function h(a){if(a)for(var b=0;b<a.length;b++)a[b](q[r])}function i(){a.cancel(s),q[r+1]&&(s=a(g,q[r+1].enter-q[r].enter))}function j(a){if(q){var b=t[a]||0;r>b?f(b):b===r&&i()}}function k(a){x.push(a)}function l(a,b){(w[a]||(w[a]=[])).push(b)}function m(a,b){(v[a]||(v[a]=[])).push(b)}function n(){return q[r]}function o(){return void 0!==s}function p(a){return o()?void b.info("$presence timer already started"):void f(a&&a.id?a.id:u)}var q,r,s,t={},u=0,v={},w={},x=[];return{init:e,registerAction:j,start:p,isActive:o,changeState:f}}])}();